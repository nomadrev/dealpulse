<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DealPulse Debug</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div id="root" class="p-4"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script type="text/javascript">
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS2ULVOVELwlyYCClrgJMaG1P15JUsCjSyG8vTYLXmuh0uO-gGbRZV9c-Ntlch0XZ3bsAeXtEAa6nND/pub?output=csv";

    const cleanText = (text) => text ? text.replace(/RSS Entry.*/gi, '').trim() : "";

    const cleanSummary = (summary, headline) => {
      let cleaned = cleanText(summary);
      if (headline && cleaned.includes(headline)) {
        cleaned = cleaned.replace(headline, '').trim();
      }
      return cleaned;
    };

    async function fetchDealsFromCSV() {
      const response = await fetch(csvUrl);
      const csvText = await response.text();

      const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });

      const data = parsed.data.map(row => {
        const trimmedRow = {};
        for (const key in row) {
          trimmedRow[key.trim()] = row[key];
        }
        return trimmedRow;
      });

      return data.map(cols => {
        const headline = cleanText(cols['Headline']);
        return {
          Date: cols['Published On'] || "N/A",
          Headline: headline || "N/A",
          Deal_Type: cols['Deal Type'] || "N/A",
          Investor_Name: cols['Investor Name'] || "N/A",
          Investee_Name: cols['Investee Name'] || "N/A",
          Target_Industry: cols['Target Industry'] || "N/A",
          Investor_Industry: cols['Investor Industry'] || "N/A",
          Deal_Value: cols['Deal Value'] || "N/A",
          Summary: cleanSummary(cols['Summary'], headline) || "N/A",
          URL: cols['Source URL'] || "#"
        };
      });
    }

    const App = ({ initialDeals }) => {
      return React.createElement("div", null,
        React.createElement("h1", { className: "text-3xl font-bold mb-6" }, "DealPulse Debug"),

        React.createElement("p", { className: "mb-4" }, `Total raw rows loaded: ${initialDeals.length}`),

        initialDeals.map((deal, index) =>
          React.createElement("div", { key: index, className: "mb-4 p-4 bg-white rounded-lg shadow" },
            React.createElement("p", null, `Date: ${deal.Date}`),
            React.createElement("p", null, `Headline: ${deal.Headline}`),
            React.createElement("p", null, `Deal Type: ${deal.Deal_Type}`),
            React.createElement("p", null, `Investor: ${deal.Investor_Name}`),
            React.createElement("p", null, `Investee: ${deal.Investee_Name}`),
            React.createElement("p", null, `Target Industry: ${deal.Target_Industry}`),
            React.createElement("p", null, `Investor Industry: ${deal.Investor_Industry}`),
            React.createElement("p", null, `Deal Value: ${deal.Deal_Value}`),
            React.createElement("p", null, `Summary: ${deal.Summary}`),
            React.createElement("a", { href: deal.URL, className: "text-blue-500", target: "_blank" }, "Source Link")
          )
        )
      );
    };

    fetchDealsFromCSV().then(deals => {
      ReactDOM.createRoot(document.getElementById('root')).render(
        React.createElement(App, { initialDeals: deals })
      );
    });
  </script>
</body>
</html>
